/*amstramgramAudioPlayer.js--@version:1.0.0--@licence:MIT--@url:https://amp.onfaitdessites.fr/*/
var AmstramgramAudioPlayer=function(){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread2(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _possibleConstructorReturn(self,call){return!call||"object"!=typeof call&&"function"!=typeof call?_assertThisInitialized(self):call}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}function _get(target,property,receiver){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(target,property,receiver){var base=_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function set(target,property,value,receiver){return(set="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(target,property,value,receiver){var desc,base=_superPropBase(target,property);if(base){if((desc=Object.getOwnPropertyDescriptor(base,property)).set)return desc.set.call(receiver,value),!0;if(!desc.writable)return!1}if(desc=Object.getOwnPropertyDescriptor(receiver,property)){if(!desc.writable)return!1;desc.value=value,Object.defineProperty(receiver,property,desc)}else _defineProperty(receiver,property,value);return!0})(target,property,value,receiver)}function _set(target,property,value,receiver,isStrict){if(!set(target,property,value,receiver||target)&&isStrict)throw new Error("failed to set property");return value}function _readOnlyError(name){throw new TypeError('"'+name+'" is read-only')}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(iter))return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _classPrivateFieldGet(receiver,privateMap){return _classApplyDescriptorGet(receiver,_classExtractFieldDescriptor(receiver,privateMap,"get"))}function _classPrivateFieldSet(receiver,privateMap,value){return _classApplyDescriptorSet(receiver,_classExtractFieldDescriptor(receiver,privateMap,"set"),value),value}function _classExtractFieldDescriptor(receiver,privateMap,action){if(!privateMap.has(receiver))throw new TypeError("attempted to "+action+" private field on non-instance");return privateMap.get(receiver)}function _classStaticPrivateFieldSpecGet(receiver,classConstructor,descriptor){return _classCheckPrivateStaticAccess(receiver,classConstructor),_classCheckPrivateStaticFieldDescriptor(descriptor,"get"),_classApplyDescriptorGet(receiver,descriptor)}function _classApplyDescriptorGet(receiver,descriptor){return descriptor.get?descriptor.get.call(receiver):descriptor.value}function _classApplyDescriptorSet(receiver,descriptor,value){if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}function _classCheckPrivateStaticAccess(receiver,classConstructor){if(receiver!==classConstructor)throw new TypeError("Private static access of wrong provenance")}function _classCheckPrivateStaticFieldDescriptor(descriptor,action){if(void 0===descriptor)throw new TypeError("attempted to "+action+" private static field before its declaration")}var EventEmitter=function(){function EventEmitter(){_classCallCheck(this,EventEmitter),this.events={}}return _createClass(EventEmitter,[{key:"_getEventListByName",value:function(eventName){return void 0===this.events[eventName]&&(this.events[eventName]=new Set),this.events[eventName]}},{key:"on",value:function(eventsNames,fn){var self=this;return eventsNames.split(" ").forEach((function(eventName){self._getEventListByName(eventName).has(fn)||self._getEventListByName(eventName).add(fn)})),this}},{key:"emit",value:function(eventName){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];return this._getEventListByName(eventName).forEach(function(fn){fn.apply(this,args)}.bind(this)),this}},{key:"off",value:function(eventName,fn){this._getEventListByName(eventName).delete(fn)}}]),EventEmitter}(),throttle=function(events,name,obj){if(void 0===obj){if("undefined"==typeof window)return;obj=window}var running=!1,func=function(e){running||(running=!0,requestAnimationFrame((function(){obj.dispatchEvent(new CustomEvent(name,{detail:e})),running=!1})))};events.split(" ").forEach((function(event){return obj.addEventListener(event,func)}))};function isObject(o){return o&&o.constructor===Object}function mergeDeep(target,source){isObject(target)&&Object.isFrozen(target)||isObject(target)&&isObject(source)&&Object.keys(source).forEach((function(key){isObject(target[key])&&isObject(source[key])?mergeDeep(target[key],source[key]):!(key in target)||_typeof(target[key])!=_typeof(source[key])&&void 0!==target[key]||(target[key]=source[key])}))}function clone(o){var copy={};return Object.keys(o).forEach((function(key){copy[key]=isObject(o[key])?clone(o[key]):o[key]})),copy}function checkString(s){return"string"==typeof s&&s.length>0}function buildSrc(params,media){if(checkString(params))return[{src:params}];if(isObject(params)&&2==Object.keys(params).length&&params.src&&params.type&&checkString(params.src)&&checkString(params.type))return!!media.canPlayType(params.type)&&[params];if(Array.isArray(params)){if(1==params.length){var o=params[0];if(o.src&&checkString(o.src))return o.type?!!media.canPlayType(o.type)&&params:[{src:o.src}]}return params.filter((function(o){return o.src&&checkString(o.src)&&o.quality&&checkString(o.quality)})).filter((function(o){return!o.type||o.type&&media.canPlayType(o.type)}))}return!1}function buildSrcParams(params,media){var init=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],result=buildSrc(params,media);if(result)return{src:result};if(isObject(params)&&(result=buildSrc(params.src,media)))return params.src=result,params;if(!init){var sources=[],sourcesTag=Array.from(media.querySelectorAll("source"));if(sourcesTag.length>0?sourcesTag.forEach((function(s){var o={};o.src=s.src,s.getAttribute("data-quality")&&(o.quality=s.getAttribute("data-quality")),s.getAttribute("type")&&(o.type=s.getAttribute("type")),Boolean(s.getAttribute("data-default"))&&(o.default=Boolean(s.getAttribute("data-default"))),sources.push(o),s.remove()})):media.src&&""!=media.src&&sources.push({src:media.src,type:media.getAttribute("type")}),result=buildSrc(sources,media))return params.src=result,params}return params.src=[],params}function secondsToTimeCode(t){var long=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(isNaN(t))return long?"00:00:00":"00:00";t=Math.round(t);var h=Math.floor(t/3600),m=Math.floor((t-3600*h)/60),s=Math.round(t%60);return(h=h>9?h+":":h>0?"0"+h+":":long?"00:":"")+(m=m>9?m:"0"+m)+":"+(s=s>9?s:"0"+s)}var instanceOptions={appLabel:"Audio Player",alwaysShowHours:!1,compactMaxWidth:600,errorMessage:"Oups ! Media can't be found !!!",hideControlsDelay:5e3,miniMaxWidth:500,timeSliderHelpText:"Use Left/Right arrow keys to go backward/forward",timeSliderLabel:"Time Slider",volumeBeforeMute:.8,volumeGroup:0,volumeSliderHelpText:"Use Up/Down arrow keys to increase/decrease the volume",volumeHorizontal:!0,volumeSliderLabel:"Volume slider"},srcOptions={autoplay:!1,crossOrigin:void 0,download:{label:"Download",disabled:!1,hidden:!1,tooltip:{hidden:!1,left:!0}},duration:120,loop:!1,more:{label:{on:"Show less",off:"Show more"},tooltip:{hidden:!1,left:!0}},mute:{label:{on:"Unmute",off:"Mute"},disabled:!1,hidden:!1,tooltip:{hidden:!1,left:!0}},next:{label:"Next",disabled:!0,hidden:!0,tooltip:{hidden:!1,left:!1}},playbackRate:1,playPause:{label:{on:"Pause",off:"Play"},tooltip:{hidden:!1,left:!1}},preload:"none",previous:{label:"Previous",disabled:!0,hidden:!0,tooltip:{hidden:!1,left:!1}},settings:{hidden:!1,qualityLabel:"QUALITY",playbackRatesLabel:"PLAYBACK SPEED",playbackRates:[["0.25 x",.25],["0.5 x",.5],["0.75 x",.75],["Normal",1],["1.5 x",1.5],["2 x",2],["4 x",4]],subsLabel:"SUBTITLES"},skipTime:"1%",src:[],subtitles:{label:{on:"Disable subtitles",off:"Enable subtitles"},disabled:!1,hidden:!1,tooltip:{hidden:!1,left:!0},state:!1,wrapper:"",container:"",sources:[],default:"fr"},volume:.8,volumeForced:!1},AudioDefaultOptions=function(){function AudioDefaultOptions(){_classCallCheck(this,AudioDefaultOptions)}return _createClass(AudioDefaultOptions,null,[{key:"instance",get:function(){return _objectSpread2({},instanceOptions)}},{key:"src",get:function(){return clone(srcOptions)}}]),AudioDefaultOptions}(),supportEventOptions=!1;document.createElement("div").addEventListener("test",(function(_){}),{get once(){return supportEventOptions=!0,!1}});var _$=function(context){context="string"==typeof context&&document.querySelector(context)?document.querySelector(context):context;return function(){var selector=arguments.length>0&&void 0!==arguments[0]?arguments[0]:context,el="string"==typeof selector&&context.querySelector(selector)?context.querySelector(selector):selector;if(el.tagName)return el.css=function(newCSS){if("string"==typeof newCSS){var v=window.getComputedStyle(el,null).getPropertyValue(newCSS);return isNaN(parseFloat(v))?v:parseFloat(v)}return Object.assign(el.style,newCSS),el},el.setAttributes=function(attrs){return Object.keys(attrs).forEach((function(key){return el.setAttribute(key,attrs[key])})),el},el.on=function(events,handler){var options=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return events.split(" ").forEach((function(e){supportEventOptions?el.addEventListener(e,handler,options):!0===options.once?el.addEventListener(e,(function listener(){handler(),el.removeEventListener(e,listener)}),1==options.capture):el.addEventListener(e,handler,1==options.capture)})),el},el.off=function(events,handler){return events.split(" ").forEach((function(e){return el.removeEventListener(e,handler)})),el},el}},_$$=function(context){context="string"==typeof context&&document.querySelector(context)?document.querySelector(context):context;return function(selector){var els=Array.isArray(selector)?selector:Array.from(context.querySelectorAll(selector));return els.css=function(newCSS){if("string"==typeof newCSS){var v=window.getComputedStyle(els[0],null).getPropertyValue(newCSS);return isNaN(parseFloat(v))?v:parseFloat(v)}return els.forEach((function(el){return Object.assign(el.style,newCSS)})),els},els.on=function(events,handler){var options=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return els.forEach((function(el){return events.split(" ").forEach((function(e){supportEventOptions?el.addEventListener(e,handler,options):!0===options.once?el.addEventListener(e,(function listener(){handler(),el.removeEventListener(e,listener)}),1==options.capture):el.addEventListener(e,handler,1==options.capture)}))})),els},els.off=function(events,handler){return els.forEach((function(el){return events.split(" ").forEach((function(e){return el.removeEventListener(e,handler)}))})),els},els}},_currentPointerType=new WeakMap,_data=new WeakMap,pointerDetector=new(function(_EventEmitter){_inherits(PointerDetector,_EventEmitter);var _super=_createSuper(PointerDetector);function PointerDetector(){var _this;if(_classCallCheck(this,PointerDetector),!PointerDetector.pointerDetector){_this=_super.call(this),_currentPointerType.set(_assertThisInitialized(_this),{writable:!0,value:void 0}),_data.set(_assertThisInitialized(_this),{writable:!0,value:{}});var w=window,s=w.sessionStorage,self=_assertThisInitialized(_this),pointerEventsInterface=_classPrivateFieldGet(_assertThisInitialized(_this),_data).pointerEventsInterface=w.PointerEvent?"pointer":w.TouchEvent?"touch":"mouse";if(_classPrivateFieldGet(_assertThisInitialized(_this),_data).pointerenter="touch"==pointerEventsInterface?"none":pointerEventsInterface+"enter",_classPrivateFieldGet(_assertThisInitialized(_this),_data).pointerleave="touch"==pointerEventsInterface?"none":pointerEventsInterface+"leave",_classPrivateFieldGet(_assertThisInitialized(_this),_data).pointerup="touch"==pointerEventsInterface?"touchend":pointerEventsInterface+"up",_classPrivateFieldGet(_assertThisInitialized(_this),_data).pointerdown="touch"==pointerEventsInterface?"touchstart":pointerEventsInterface+"down",_classPrivateFieldGet(_assertThisInitialized(_this),_data).pointermove=pointerEventsInterface+"move",s.hasOwnProperty("amst__currentPointerType")||("pointer"==pointerEventsInterface?s.setItem("amst__currentPointerType","touch"):s.setItem("amst__currentPointerType",pointerEventsInterface)),_classPrivateFieldSet(_assertThisInitialized(_this),_currentPointerType,s.getItem("amst__currentPointerType")),"pointer"==pointerEventsInterface){function getPointerType(e){if(e.pointerType==_classPrivateFieldGet(self,_currentPointerType))return!1;"mouse"==e.pointerType?w.removeEventListener("pointermove",getPointerType):w.addEventListener("pointermove",getPointerType),_classPrivateFieldSet(self,_currentPointerType,e.pointerType),s.setItem("amst__currentPointerType",e.pointerType),self.emit("amst__pointerChange")}"mouse"!=_classPrivateFieldGet(self,_currentPointerType)&&w.addEventListener("pointermove",getPointerType),w.addEventListener("pointerdown",getPointerType)}PointerDetector.pointerDetector=_assertThisInitialized(_this)}return _possibleConstructorReturn(_this,PointerDetector.pointerDetector)}return _createClass(PointerDetector,[{key:"currentPointerType",get:function(){return _classPrivateFieldGet(this,_currentPointerType)}},{key:"data",get:function(){return _classPrivateFieldGet(this,_data)}}]),PointerDetector}(EventEmitter));Object.freeze(pointerDetector);var _hidden=new WeakMap,Button=function(){function Button(name,player,ui){var _this=this,backgroundClass=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"amst__svg-background";_classCallCheck(this,Button),_hidden.set(this,{writable:!0,value:void 0}),backgroundClass=""===backgroundClass?"":' class="'.concat(backgroundClass,'"'),ui.insertAdjacentHTML("beforeend",'<div role="button" class="amst__'.concat(name,'" tabindex="0"><div').concat(backgroundClass,"></div></div>")),this.name=name,this.player=player,this.params=player.params[name],this.button=ui.querySelector(".amst__".concat(name)),_classPrivateFieldSet(this,_hidden,this.params.hidden),this.button.addEventListener("click",(function(e){return _this.player.emit("amst__".concat(name,"-click"),_this,e)})),this.button.addEventListener("focus",(function(_){return _this.player.emit("amst__focus")})),player.on("amst__src-change amst__".concat(name,"-should-update"),(function(_){return _this.update()}))}return _createClass(Button,[{key:"update",value:function(){var label=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.params.label,b=this.button,p=this.params;label&&b.setAttribute("aria-label",label),p.disabled&&!0===p.disabled?b.setAttribute("data-disabled",!0):b.removeAttribute("data-disabled"),!0===p.hidden?b.classList.add("amst__hidden"):b.classList.remove("amst__hidden"),p.tooltip&&!1===p.tooltip.hidden&&""!=label?(b.classList.add("amst__tooltip"),!0===p.tooltip.left?b.classList.add("amst__tooltip-left"):b.classList.remove("amst__tooltip-left")):b.classList.remove("amst__tooltip","amst__tooltip-left"),p.hidden!=_classPrivateFieldGet(this,_hidden)&&(_classPrivateFieldSet(this,_hidden,p.hidden),this.player.emit("amst__should-resize")),this.player.emit("amst__".concat(this.name,"-update"),this)}}]),Button}(),_state$1=new WeakMap,ToggleButton=function(_Button){_inherits(ToggleButton,_Button);var _super=_createSuper(ToggleButton);function ToggleButton(name,player,ui,backgroundClass){var _this;return _classCallCheck(this,ToggleButton),_this=_super.call(this,name,player,ui,backgroundClass),_state$1.set(_assertThisInitialized(_this),{writable:!0,value:!1}),_this}return _createClass(ToggleButton,[{key:"update",value:function(){_get(_getPrototypeOf(ToggleButton.prototype),"update",this).call(this,this.state?this.params.label.on:this.params.label.off)}},{key:"state",get:function(){return _classPrivateFieldGet(this,_state$1)},set:function(state){if(state!=_classPrivateFieldGet(this,_state$1)){var b=this.button;state?b.classList.add("amst__on"):b.classList.remove("amst__on"),_classPrivateFieldSet(this,_state$1,state),this.update()}}}]),ToggleButton}(Button),MuteButton=function(_ToggleButton){_inherits(MuteButton,_ToggleButton);var _super=_createSuper(MuteButton);function MuteButton(player,ui){var _this;_classCallCheck(this,MuteButton),_this=_super.call(this,"mute",player,ui);var playerParams=player.params,storage=window.sessionStorage;return playerParams.isMobile&&(playerParams.volumeBeforeMute=1),playerParams.media.on("volumechange",(function(_){var v=player.volume;storage.setItem("amst__volumegroup".concat(playerParams.volumeGroup),v),v>.1&&!playerParams.isMobile&&(playerParams.volumeBeforeMute=v),_this.state=player.muted})),player.on("amst__src-change",(function(_){!0!==playerParams.volumeForced&&storage.getItem("amst__volumegroup".concat(playerParams.volumeGroup))?storage.getItem("amst__volumegroup".concat(playerParams.volumeGroup))&&(playerParams.volume=Number(storage.getItem("amst__volumegroup".concat(playerParams.volumeGroup)))):storage.setItem("amst__volumegroup".concat(playerParams.volumeGroup),playerParams.volume),player.volume=playerParams.volume,_this.state=player.muted})).on("amst__mute-click",(function(_){(playerParams.isMobile||"mouse"==playerParams.currentPointerType||"horizontal"==playerParams.volumeOrientation)&&_this.toggle()})),playerParams.$().on("keydown",(function(e){_this.params.disabled||_this.params.hidden||77!=e.which||(e.preventDefault(),_this.toggle(),_this.button.blur(),_this.button.focus())})),_this}return _createClass(MuteButton,[{key:"update",value:function(){var p=this.player.params;p.isMobile||(1==this.params.hidden?p.$(".amst__volume").classList.add("amst__hidden"):p.$(".amst__volume").classList.remove("amst__hidden")),_get(_getPrototypeOf(MuteButton.prototype),"update",this).call(this)}},{key:"toggle",value:function(){this.state=!this.state,this.player.volume=this.state?0:this.player.params.volumeBeforeMute}}]),MuteButton}(ToggleButton),Slider=function(_EventEmitter){_inherits(Slider,_EventEmitter);var _super=_createSuper(Slider);function Slider(player,ui){var _this,vertical=arguments.length>2&&void 0!==arguments[2]&&arguments[2],reactiveArea=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;_classCallCheck(this,Slider),_this=_super.call(this),ui.insertAdjacentHTML("beforeend",'\n      <div class="amst__slider" aria-valuemin="0" aria-valuemax="1" role="slider" tabindex="0">\n        <div class="amst__slider-total">\n          <div class="amst__slider-current"></div>\n        </div>\n      </div>\n    ');var self=_assertThisInitialized(_this),$=_$(ui.querySelector(".amst__slider")),params=player.params;function pointerdown(e){var ref=self.referenceRect,cleanEvents="pointerId"in e?"".concat(params.pointerup):"".concat(params.pointerleave," ").concat(params.pointerup);function getRatio(e){var ratio,x=e.clientX||e.pageX-window.pageXOffset,y=e.clientY||e.pageY-window.pageYOffset;x&&y&&(vertical?ratio=1-(ratio=y-ref.top)/ref.height:(ratio=x-ref.left,ratio/=ref.width),ratio=Math.max(0,Math.min(ratio,1)),self.emit("amst__slider-change",ratio))}"pointerId"in e&&reactiveArea.setPointerCapture(e.pointerId),getRatio(e),reactiveArea.on("".concat(params.pointermove," ").concat(params.pointerup),getRatio).on(cleanEvents,(function clean(){reactiveArea.off("".concat(params.pointermove," ").concat(params.pointerup),getRatio).off(cleanEvents,clean)}))}function referenceRectUpdate(){setTimeout((function(_){self.referenceRect=self.total.getBoundingClientRect()}),1)}return _this.params=params,_this.slider=$(),_this.total=$(".amst__slider-total"),_this.current=$(".amst__slider-current"),_this.referenceRect=_this.total.getBoundingClientRect(),_this.slider.on("focus",(function(_){return player.emit("amst__focus")})),reactiveArea=reactiveArea||$(),player.on("amst__resize",referenceRectUpdate),vertical&&reactiveArea.on(params.pointerenter,referenceRectUpdate),params.media.on("loadedmetadata",referenceRectUpdate),reactiveArea.on(params.pointerdown,pointerdown),_this}return Slider}(EventEmitter),VolumeButton=function(_VolumeSlider){_inherits(VolumeButton,_VolumeSlider);var _super=_createSuper(VolumeButton);function VolumeButton(player,ui){var _this;_classCallCheck(this,VolumeButton);var params=player.params,volumeOrientation=!0!==params.volumeHorizontal?" amst__vertical":"";ui.insertAdjacentHTML("beforeend",'<div class="amst__volume'.concat(volumeOrientation,'"><div class="amst__volume-wrapper"></div></div>'));var wrapper=ui.querySelector(".amst__volume-wrapper"),muteButton=new MuteButton(player,wrapper);_this=_super.call(this,player,wrapper," amst__vertical"==volumeOrientation),Object.defineProperty(params,"volumeHorizontal",{writable:!1});var slider=_this.slider,hideSliderTimeout=!1,clickTimeout=!1,timeNow=0;function hideSlider(){"vertical"!=params.volumeOrientation||params.isMobile||"mouse"==params.currentPointerType||(hideSliderTimeout&&clearTimeout(hideSliderTimeout),hideSliderTimeout=setTimeout((function(_){hideSliderTimeout=!1,slider.classList.remove("amst__show")}),params.hideControlsDelay))}return params.media.on("volumechange",hideSlider),"vertical"==params.volumeOrientation&&("video"==params.type&&player.on("amst__controlsAreHidden",(function(_){"mouse"!=params.currentPointerType&&slider.classList.remove("amst__show")})),muteButton.button.addEventListener(params.pointerdown,(function(_){"mouse"!=params.currentPointerType&&(hideSliderTimeout&&clearTimeout(hideSliderTimeout),0==timeNow?(timeNow=Date.now(),clickTimeout=setTimeout((function(_){timeNow=0,slider.classList.toggle("amst__show"),slider.classList.contains("amst__show")&&(hideSlider(),window.dispatchEvent(new Event("amst__optimizedScrollResize")))}),250)):(clearTimeout(clickTimeout),clearTimeout(hideSliderTimeout),timeNow=0,muteButton.toggle(),slider.classList.remove("amst__show")))}))),_this}return VolumeButton}(function(_Slider){_inherits(VolumeSlider,_Slider);var _super=_createSuper(VolumeSlider);function VolumeSlider(player,ui){var _this,vertical=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,VolumeSlider);var slider=(_this=_super.call(this,player,ui,vertical)).slider,params=_this.params,media=params.media,current=_this.current;function update(){var v=Math.round(100*player.volume);current.style.width=v+"%",slider.setAttributes({"aria-valuenow":v/100,"aria-valuetext":v+"%"})}return slider.setAttribute("aria-label",player.params.volumeSliderLabel),slider.insertAdjacentHTML("afterbegin",'<span class="amst__offscreen">'.concat(player.params.volumeSliderHelpText,"</span>")),params.$().on("keydown",(function(e){if(!0!==params.mute.disabled&&!0!==params.mute.hidden){if(![38,40].includes(e.which)||e.shiftKey)return;switch(e.preventDefault(),slider.blur(),slider.focus(),e.which){case 40:player.volume=Math.max(0,player.volume-.05);break;case 38:player.volume=Math.min(1,player.volume+.05)}}}),!1),_this.on("amst__slider-change",(function(vol){return player.volume=vol})),media.on("volumechange",update),player.on("amst__src-change",update),Object.defineProperty(params,"volumeSliderLabel",{writable:!1}),Object.defineProperty(params,"volumeSliderHelpText",{writable:!1}),_this}return VolumeSlider}(Slider)),TimeSlider=function(_Slider){_inherits(TimeSlider,_Slider);var _super=_createSuper(TimeSlider);function TimeSlider(player,ui){var _this;_classCallCheck(this,TimeSlider),ui.insertAdjacentHTML("beforeend",'\n      <div class="amst__time amst__time-current" role="timer" aria-live="off"><span class="amst__currenttime"></span></div>\n      <div class="amst__time-rail">\n        <div class="amst__time-slider"></div>\n      </div>\n      <div class="amst__time amst__time-duration"><span class="amst__duration"></span></div>\n    ');var $=_$(ui.querySelector(".amst__time-slider"));_this=_super.call(this,player,$(),!1,$()),$(".amst__slider").insertAdjacentHTML("afterbegin",'<span class="amst__offscreen">'.concat(player.params.timeSliderHelpText,"</span>")),$(".amst__slider").setAttribute("aria-label",player.params.timeSliderLabel),_this.total.insertAdjacentHTML("afterbegin",'<canvas class="amst__loaded-bar"></canvas>'),_this.total.insertAdjacentHTML("beforeend",'\n      <div class="amst__buffering-bar"></div>\n      <div class="amst__cursor"><div></div></div>\n      <div class="amst__seeking-wrapper">\n        <div class="amst__time amst__seeking">\n          <span></span>\n        </div>\n      </div>\n      <div class="amst__time-handler"></div>\n    ');var buffered,seekingOffset,self=_assertThisInitialized(_this),params=_this.params,media=params.media,wrapper=params.$(),slider=_this.slider,current=_this.current,handler=$(".amst__time-handler"),cursor=$(".amst__cursor"),seeking=$(".amst__seeking-wrapper"),seekingTime=$(".amst__seeking-wrapper span"),mustShowHours=params.alwaysShowHours;function updateDuration(){media.duration&&(params.duration=media.duration),(mustShowHours=params.alwaysShowHours||params.duration>=3600)?params.$$(".amst__time").forEach((function(el){return el.classList.add("amst__long")})):params.$$(".amst__time").forEach((function(el){return el.classList.remove("amst__long")})),params.$(".amst__currenttime").innerHTML=secondsToTimeCode(media.currentTime||0,mustShowHours),params.$(".amst__duration").innerHTML=secondsToTimeCode(params.duration,mustShowHours),slider.setAttribute("aria-valuemax",params.duration),update(media.currentTime/params.duration)}player.on("amst__src-change",(function(_){_this.off("amst__slider-change",update),buffered=void 0,seekingOffset=void 0,updateDuration()})),media.on("timeupdate",update).on("progress",updateBuffer).on("durationchange",updateDuration).on("loadedmetadata",(function(_){return _this.on("amst__slider-change",update)})).on("ended",(function(_){media.currentTime=0,player.pause()})),wrapper.on("keydown",(function(e){if([37,39].includes(e.which)&&wrapper.classList.contains("amst__loadedmetadata")){e.preventDefault(),slider.blur(),slider.focus();var skipTime="string"==typeof params.skipTime&&"%"==params.skipTime.slice(-1)?parseInt(params.skipTime)*media.duration/100:parseInt(params.skipTime);switch(e.which){case 37:media.currentTime=Math.max(0,media.currentTime-skipTime);break;case 39:media.currentTime=Math.min(media.duration,media.currentTime+skipTime)}}}),!1);var updateTimeout,updateTimeRailAnimation,loadedBar=$(".amst__loaded-bar"),ctxLoadedBar=loadedBar.getContext("2d");function updateBuffer(){if(loadedBar.height||(loadedBar.height=loadedBar.offsetHeight,ctxLoadedBar.fillStyle=loadedBar.css("color")),!function(t1,t2){if(!t1||!t2||t1.length!=t2.length)return!1;for(var i=0;i<t1.length;i++)if(t1.start(i)!=t2.start(i)||t1.end(i)!=t2.end(i))return i=t1.length,!1;return!0}(media.buffered,buffered)){ctxLoadedBar.clearRect(0,0,loadedBar.width,loadedBar.height);for(var inc=loadedBar.width/media.duration,i=0;i<media.buffered.length;i++){var start=media.buffered.start(i)*inc,width=media.buffered.end(i)*inc-start;new AmstRoundedRect(ctxLoadedBar,loadedBar.height,start,width)}buffered=media.buffered}}function update(ratio){if(cancelAnimationFrame(updateTimeRailAnimation),params.duration){"number"==typeof ratio&&ratio>0&&(media.off("timeupdate",update),clearTimeout(updateTimeout),media.currentTime=ratio*params.duration,updateTimeout=setTimeout((function(_){return media.on("timeupdate",update)}),50)),updateTimeRail(),updateBuffer();var currentTime=media.currentTime;params.$$(".amst__currenttime").forEach((function(el){return el.innerHTML=secondsToTimeCode(currentTime,mustShowHours)})),slider.setAttributes({"aria-valuenow":currentTime,"aria-valuetext":secondsToTimeCode(currentTime)})}}function updateTimeRail(){var ratio=media.currentTime/params.duration;ratio=Math.max(0,Math.min(ratio,1)),current.style.transform="scaleX(".concat(ratio,")"),handler.style.transform="translateX(".concat(ratio*self.referenceRect.width,"px)"),"video"==params.type&&self.emit("amst__time-slider-update",ratio),media.paused||(updateTimeRailAnimation=requestAnimationFrame(updateTimeRail))}return loadedBar.height=0,"touch"!=params.pointerEventsInterface&&throttle(params.pointermove,"amst__optimizedPointerMove",$()),$().on("amst__optimizedPointerMove",(function(e){if(media.duration&&(!e.detail.pointerType||"touch"!=e.detail.pointerType)){if(!seekingOffset){var cursorInner=$(".amst__cursor>div");seekingOffset=.5*seeking.css("width"),seekingOffset-=parseInt(window.getComputedStyle(cursorInner,":after").getPropertyValue("border-bottom-width")),seekingOffset-=.5*cursorInner.css("width")}var pos=(e.detail.clientX||e.detail.pageX-window.pageXOffset)-_this.referenceRect.left,ratio=(pos=Math.max(Math.min(pos,_this.referenceRect.width),0))/_this.referenceRect.width;seekingTime.innerHTML=secondsToTimeCode(media.duration*ratio,mustShowHours),cursor.css({transform:"translateX(".concat(pos,"px)")}),pos=Math.max(pos,seekingOffset),pos=Math.min(pos,_this.referenceRect.width-seekingOffset),seeking.css({transform:"translateX(".concat(pos,"px)")}),"video"==params.type&&_this.emit("amst__move-over-time-slider",ratio)}})),_this}return TimeSlider}(Slider),AmstRoundedRect=function AmstRoundedRect(ctx,h,x,w){_classCallCheck(this,AmstRoundedRect);ctx.beginPath(),ctx.moveTo(x+2,0),ctx.lineTo(x+w-2,0),ctx.quadraticCurveTo(x+w,0,x+w,2),ctx.lineTo(x+w,0+h-2),ctx.quadraticCurveTo(x+w,0+h,x+w-2,0+h),ctx.lineTo(x+2,0+h),ctx.quadraticCurveTo(x,0+h,x,0+h-2),ctx.lineTo(x,2),ctx.quadraticCurveTo(x,0,x+2,0),ctx.closePath(),ctx.fill()};var _init$1=new WeakMap,_buildTextTracks=new WeakSet,SubtitlesButton=function(_ToggleButton){_inherits(SubtitlesButton,_ToggleButton);var _super=_createSuper(SubtitlesButton);function SubtitlesButton(player,ui){var _this;_classCallCheck(this,SubtitlesButton),_this=_super.call(this,"subtitles",player,ui),_buildTextTracks.add(_assertThisInitialized(_this)),_init$1.set(_assertThisInitialized(_this),{writable:!0,value:!1});var _params=_this.params,media=_this.media=player.params.media;if(0==_params.sources.length){var subsSources=[],tracks=player.params.$$("track[src][srclang][label]",media);tracks.length>0&&tracks.forEach((function(t){subsSources.push({src:t.src,srclang:t.srclang,label:t.label}),t.default&&!_params.default&&(_params.default=t.srclang)})),_params.sources=subsSources}return player.on("amst__src-change",(function(_){return function(receiver,privateSet,fn){if(!privateSet.has(receiver))throw new TypeError("attempted to get private field on non-instance");return fn}(_assertThisInitialized(_this),_buildTextTracks,_buildTextTracks2).call(_assertThisInitialized(_this))})),player.on("amst__subtitles-click",(function(_){return _this.state=!_this.state})),_this}return _createClass(SubtitlesButton,[{key:"state",get:function(){return _get(_getPrototypeOf(SubtitlesButton.prototype),"state",this)},set:function(state){state=state&&!this.params.hidden,this.wrapper&&(state?this.wrapper.classList.remove("amst__hide-subtitles"):this.wrapper.classList.add("amst__hide-subtitles")),_set(_getPrototypeOf(SubtitlesButton.prototype),"state",this.params.state=state,this,!0)}},{key:"update",value:function(){this.wrapper=null,this.container=null;var params=this.params;try{this.wrapper=document.querySelector(params.wrapper),this.container=document.querySelector(params.container)}catch(e){try{this.wrapper=this.player.params.$(".amst__subtitles-wrapper"),this.container=this.player.params.$(".amst__subtitles-container")}catch(e){}}params.hidden=params.hidden||0==params.sources.length||null==this.wrapper||null==this.container,this.state=params.state,_get(_getPrototypeOf(SubtitlesButton.prototype),"update",this).call(this)}}]),SubtitlesButton}(ToggleButton),_buildTextTracks2=function(){var _this2=this;if(_classPrivateFieldGet(this,_init$1)&&0==this.params.sources.length&&this.player.params.$$('track[kind="subtitles"]').forEach((function(t){return t.remove()})),0!=this.params.sources.length&&this.wrapper&&this.container){var params=this.params;!function(arr){var key=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label";function compare(a,b){var valA=a[key].toUpperCase(),valB=b[key].toUpperCase(),comparison=0;return valA>valB?comparison=1:valA<valB&&(comparison=-1),comparison}try{arr.sort(compare)}catch(e){return arr}}(params.sources);var html="";params.sources.filter((function(s){return isString(s.src)&&isString(s.srclang)&&isString(s.label)})).forEach((function(s){html+='<track kind="subtitles" src="'.concat(s.src,'" srclang="').concat(s.srclang,'" label="').concat(s.label,'" type="text/vtt">')})),this.media.innerHTML=html,this.wrapper.classList.add("amst__subtitles-empty");for(var activeTrack=null,textTracks=this.media.textTracks,_loop=function(i){var t=textTracks[i];t.mode="disabled",t.addEventListener("cuechange",(function(_){_this2.container.innerHTML="",t.activeCues.length>0&&_this2.container.appendChild(t.activeCues[0].getCueAsHTML()),""==_this2.container.innerHTML?_this2.wrapper.classList.add("amst__subtitles-empty"):_this2.wrapper.classList.remove("amst__subtitles-empty")})),t.language!=window.navigator.language&&t.language.split("-")[0]!=window.navigator.language.split("-")[0]||(activeTrack=t)},i=0;i<textTracks.length;i++)_loop(i);if(!activeTrack)for(var _i=0;_i<textTracks.length;_i++){var t=textTracks[_i];t.language!=params.default&&t.language.split("-")[0]!=params.default.split("-")[0]||(activeTrack=t)}activeTrack||(activeTrack=textTracks[0]),activeTrack.mode="hidden",_classPrivateFieldSet(this,_init$1,!0)}};function isString(str){return"string"==typeof str&&""!=str}var _state=new WeakMap,SettingsButton=function(_Button){_inherits(SettingsButton,_Button);var _super=_createSuper(SettingsButton);function SettingsButton(player,ui){var _this;_classCallCheck(this,SettingsButton),_this=_super.call(this,"settings",player,ui),_state.set(_assertThisInitialized(_this),{writable:!0,value:!1}),_this.button.insertAdjacentHTML("beforeend",'<div class="amst__settings-display"><div></div><ul></ul></div>');var button=_this.button,settingsWrapper=button.querySelector(".amst__settings-display"),$=player.params.$,nodal=_this.nodal=player.params.nodal,self=_assertThisInitialized(_this);function hide(){nodal.hide(),nodal.container.removeEventListener("click",onNodalClick),window.removeEventListener("click",onWindowClick),button.classList.remove("amst__on"),_classPrivateFieldSet(self,_state,!1)}function onWindowClick(e){for(var el=e.target;el=el.parentNode;)if(el==self.settingsContainer)return;hide()}function onNodalClick(e){e.target==e.currentTarget&&hide(),e.target.hasAttribute("data-setting")&&!e.target.classList.contains("amst__selected")&&change(e)}function change(e){var setting=e.target.getAttribute("data-setting"),value=e.target.getAttribute("data-value"),media=player.params.media,oldLine=$('li[data-setting="'.concat(setting,'"].amst__selected')),oldValue="quality"==setting?oldLine.innerHTML:oldLine.getAttribute("data-value"),newLine=$('li[data-value="'.concat(value,'"]')),newValue="quality"==setting?newLine.innerHTML:value;if($('li[data-setting="'.concat(setting,'"].amst__selected')).classList.remove("amst__selected"),$('li[data-value="'.concat(value,'"]')).classList.add("amst__selected"),nodal.visible&&nodal.show("<ul>"+self.settingsContainer.innerHTML+"</ul>"),"playbackRate"==setting&&(media.playbackRate=parseFloat(value),player.emit("amst__playbackRate-change",oldValue,newValue),player.emit("amst__settings-change","playbackRate",oldValue,newValue)),"quality"==setting){var quality=e.target.textContent,s=window.sessionStorage,type=player.params.type,currentTime=media.currentTime,playbackRate=media.playbackRate,isPlaying=!player.paused,readyState=media.readyState>0;quality!=s.getItem("amst__".concat(type,"DefaultQuality"))&&s.setItem("amst__".concat(type,"DefaultQuality"),quality),isPlaying&&media.pause(),media.src=value,readyState&&media.load(),media.on("loadeddata",(function restoreCurrentTime(){media.off("loadeddata",restoreCurrentTime),media.currentTime=currentTime})),media.playbackRate=playbackRate,player.emit("amst__quality-change",oldValue,newValue),player.emit("amst__settings-change",setting,oldValue,newValue),isPlaying&&media.play()}if("subs"==setting){for(var i=0;i<media.textTracks.length;i++)media.textTracks[i].mode=media.textTracks[i].language==value?"hidden":"disabled",player.subtitles={state:!0};player.emit("amst__subs-change",oldValue,newValue),player.emit("amst__settings-change",setting,oldValue,newValue)}self.button.blur()}return _this.settingsContainer=settingsWrapper.querySelector("ul"),button.querySelector(".amst__svg-background").addEventListener(player.params.pointerup,(function(_){"mouse"!=player.params.currentPointerType&&(_this.state?hide():function(){window.innerWidth<=720||window.innerHeight<=720?(nodal.show("<ul>"+self.settingsContainer.innerHTML+"</ul>"),setTimeout((function(_){return nodal.container.addEventListener("click",onNodalClick)}),50)):setTimeout((function(_){return window.addEventListener("click",onWindowClick)}),50);button.classList.add("amst__on"),_classPrivateFieldSet(self,_state,!0)}())})),_this.settingsContainer.addEventListener("click",(function(e){e.target.hasAttribute("data-setting")&&!e.target.classList.contains("amst__selected")&&change(e)})),player.on("amst__src-change",hide).on("amst__resize",(function(){var rectTop=button.getBoundingClientRect().top,scrollTop=window.pageYOffset||document.documentElement.scrollTop;rectTop+scrollTop<350?settingsWrapper.classList.add("amst__align-bottom"):settingsWrapper.classList.remove("amst__align-bottom")})),_this}return _createClass(SettingsButton,[{key:"state",get:function(){return _classPrivateFieldGet(this,_state)}},{key:"update",value:function(){var _this2=this;_get(_getPrototypeOf(SettingsButton.prototype),"update",this).call(this);var params=this.params,media=this.player.params.media;if(this.settingsContainer.innerHTML="",!params.hidden){var listHTML="",sources=this.player.params.src.filter((function(el){return el.quality}));if(params.playbackRates.length>0&&(listHTML="\n          <li>\n            <span>".concat(params.playbackRatesLabel,"</span>\n            <ul>\n          "),params.playbackRates.forEach((function(el){var selected=(el=Array.isArray(el)?el:[el,parseFloat(el)])[1]==_this2.player.params.playbackRate?' class="amst__selected"':"";listHTML+='<li data-setting="playbackRate" data-value="'.concat(el[1],'"').concat(selected,">").concat(el[0],"</li>")})),listHTML+="</ul></li>"),sources.length>1&&(listHTML+="\n          <li>\n            <span>".concat(params.qualityLabel,"</span>\n            <ul>\n          "),sources.forEach((function(el){var id=media.src.lastIndexOf(el.src),selected=id>=0&&media.src.substring(0,id)+el.src==media.src?' class="amst__selected"':"";listHTML+='<li data-setting="quality" data-value="'.concat(el.src,'"').concat(selected,">").concat(el.quality,"</li>")})),listHTML+="</ul></li>"),media.textTracks.length>1){listHTML+="\n          <li>\n            <span>".concat(params.subsLabel,"</span>\n            <ul>\n          ");for(var i=0;i<media.textTracks.length;i++){var t=media.textTracks[i],selected="hidden"==t.mode?' class="amst__selected"':"";listHTML+='<li data-setting="subs" data-value="'.concat(t.language,'"').concat(selected,">").concat(t.label,"</li>")}listHTML+="</ul></li>"}this.settingsContainer.innerHTML=listHTML,0==this.settingsContainer.childNodes.length&&this.button.classList.add("amst__hidden")}this.player.emit("amst__should-resize")}}]),SettingsButton}(Button);throttle("resize scroll","amst__optimizedScrollResize");var timeWidth,longTimeWidth,w$1=window,d=document,s$1=w$1.sessionStorage;if(s$1.getItem("amst__timeWidth"))timeWidth=s$1.getItem("amst__timeWidth"),longTimeWidth=s$1.getItem("amst__longTimeWidth");else{var measureTime=d.createElement("div"),measureLongTime=d.createElement("div");measureTime.classList.add("amst__measureTime"),measureTime.innerHTML="<span>00:00<span>",measureLongTime.classList.add("amst__measureTime"),measureLongTime.innerHTML="<span>00:00:00<span>",d.body.appendChild(measureTime),d.body.appendChild(measureLongTime),timeWidth=measureTime.offsetWidth+2,longTimeWidth=measureLongTime.offsetWidth+2,d.body.removeChild(measureTime),d.body.removeChild(measureLongTime),s$1.setItem("amst__timeWidth",timeWidth),s$1.setItem("amst__longTimeWidth",longTimeWidth)}var style=d.createElement("style");style.appendChild(d.createTextNode("")),d.head.appendChild(style),style.sheet.insertRule(".amst__time>span{width:".concat(timeWidth,"px;"),0),style.sheet.insertRule(".amst__time.amst__long>span{width:".concat(longTimeWidth,"px;"),0);var AudioUI=function(){function AudioUI(player){var _this=this;_classCallCheck(this,AudioUI);var self=this,params=player.params,$=params.$,$$=params.$$,media=params.media,container=$(".amst__container"),controls=$(d.createElement("div"));this.player=player,new Button("previous",player,controls);var playPauseButton=new ToggleButton("playPause",player,controls);player.on("amst__playPause-click",(function(button){return button.state?player.pause():player.play()})),new Button("next",player,controls),this.timeSlider=new TimeSlider(player,controls),params.isMobile?new MuteButton(player,controls):new VolumeButton(player,controls);var additionalControls=$(d.createElement("div"));additionalControls.classList.add("amst__additional-controls"),new SubtitlesButton(player,additionalControls),this.settingsButton=new SettingsButton(player,additionalControls),new Button("download",player,additionalControls),player.on("amst__download-click",(function(b){if(!b.params.disabled){var a=d.createElement("a");a.href=media.src,a.download=decodeURI(media.src.substring(media.src.lastIndexOf("/")+1)),d.body.appendChild(a),a.click(),d.body.removeChild(a)}})),controls.appendChild(additionalControls),new ToggleButton("more",player,controls,""),player.on("amst__more-click",(function(b){b.state=!b.state,b.state?$().classList.add("amst__show-additional-controls"):$().classList.remove("amst__show-additional-controls")})),controls.classList.add("amst__controls"),container.appendChild(controls),container.insertAdjacentHTML("beforeend",'<div class="amst__error"><p>'.concat(params.errorMessage,"</p></div>")),container.insertAdjacentHTML("beforeend",'<div class="amst__contextmenu"><a href="http://onfaitdessites.fr" target="_blank">AmstramgramMediaPlayer<br>by onFaitDesSites</a></div>');var animIsRunning=!1,contextCleanStyleTimeout=null;function resize(){if(0!=container.getBoundingClientRect().height){self.boundingRect=container.getBoundingClientRect();var playerWidth=self.boundingRect.width;playerWidth<=params.compactMaxWidth?($().classList.add("amst__compact"),playerWidth<=params.miniMaxWidth&&$$(".amst__additional-controls div[role=button]").length-$$(".amst__additional-controls div[role=button].amst__hidden").length>1?$().classList.add("amst__mini"):$().classList.remove("amst__mini")):($().classList.remove("amst__mini"),$().classList.remove("amst__compact")),player.emit("amst__resize")}else setTimeout(resize,1)}$().on("contextmenu",(function(e){//!e.offsetX means obsolete browsers
if(e.preventDefault(),e.offsetX&&!animIsRunning){var r,now;if(!animIsRunning){animIsRunning=!0,r=.3,now=Date.now();var rect=self.boundingRect,width=rect.width,height=rect.height,x=e.clientX||e.pageX-window.pageXOffset,y=e.clientY||e.pageY-window.pageYOffset,left=x-rect.left<.5*width?x-rect.left+5+"px":"unset",right=x-rect.left<.5*width?"unset":rect.right-x+5+"px",top=y-rect.top<.5*height?y-rect.top+10+"px":"unset",bottom=y-rect.top<.5*height?"unset":rect.bottom-y+10+"px",transform="none";width<450&&(_readOnlyError("left"),left="50%",_readOnlyError("transform"),transform="translateX(-50%)"),$(".amst__contextmenu").css({left:left,right:right,top:top,bottom:bottom,transform:transform}).classList.add("amst__contextmenu-show"),contextCleanStyleTimeout&&clearTimeout(contextCleanStyleTimeout),w$1.requestAnimationFrame((function anim(){if(Date.now()-now<40)return void w$1.requestAnimationFrame(anim);now=Date.now(),r=Math.max(0,r-.03),$(".amst__contextmenu").css({filter:"url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0 ".concat(r,"' result='N' numOctaves='2' /><feDisplacementMap in='SourceGraphic' in2='N' scale='100' xChannelSelector='R' yChannelSelector='R'></feDisplacementMap></filter></svg>#n\")")}),r>0?w$1.requestAnimationFrame(anim):animIsRunning=!1}))}w$1.addEventListener("click",removeContext),player.on("amst__resize",removeContext)}function removeContext(){w$1.removeEventListener("click",removeContext),player.off("amst__resize",removeContext),$(".amst__contextmenu").classList.remove("amst__contextmenu-show"),contextCleanStyleTimeout=setTimeout((function(){$(".amst__contextmenu").removeAttribute("style")}),400)}})),$().on("keydown",(function(e){function setKeyboardIsInactive(){$().classList.remove("amst__keyboard-active"),w$1.removeEventListener(params.pointermove,setKeyboardIsInactive),w$1.removeEventListener(params.pointerdown,setKeyboardIsInactive)}$().classList.add("amst__keyboard-active"),w$1.addEventListener(params.pointermove,setKeyboardIsInactive,!1),w$1.addEventListener(params.pointerdown,setKeyboardIsInactive,!1),32==e.which&&(e.preventDefault(),playPauseButton.button.focus(),player.toggle())})),media.on("loadedmetadata",(function(_){return $().classList.add("amst__loadedmetadata")})).on("play playing seeked canplay",(function(_){return $().classList.remove("amst__buffering")})).on("seeking waiting loadeddata",(function(_){return $().classList.add("amst__buffering")})).on("error",(function(_){3==media.networkState&&(player.pause(),$().classList.remove("amst__buffering"),$().classList.add("amst__show-error"),player.emit("amst__error"))})),player.on("amst__src-change",(function(_){$().classList.remove("amst__loadedmetadata"),$().classList.remove("amst__show-error"),resize()})).on("amst__should-play",(function(_){return $().classList.add("amst__buffering")})).on("amst__play amst__should-play",(function(_){return playPauseButton.state=!0})).on("amst__pause",(function(_){return playPauseButton.state=!1})).on("amst__should-reset",(function(_){return _this.reset()})),player.on("amst__should-resize",resize),w$1.addEventListener("amst__optimizedScrollResize",resize)}return _createClass(AudioUI,[{key:"reset",value:function(){var params=this.player.params,media=params.media,resetTime=media.currentTime,currentSrc=media.src;params.$().classList.remove("amst__loadedmetadata"),params.$().classList.remove("amst__buffering"),media.src="",media.preload="none",media.autoplay=!1,media.load(),media.src=currentSrc;try{media.currentTime=resetTime}catch(e){media.addEventListener("loadedmetadata",(function restoreCurrentTime(){media.removeEventListener("loadedmetadata",restoreCurrentTime),media.currentTime=resetTime}))}this.player.emit("amst__reset")}}]),AudioUI}(),_visible=new WeakMap,nodal=new(function(){function Nodal(){return _classCallCheck(this,Nodal),_visible.set(this,{writable:!0,value:!1}),Nodal.nodal||(this.container=document.createElement("div"),this.container.classList.add("amst__hidden"),this.container.setAttribute("data-role","amst__nodal"),document.body.appendChild(this.container),Nodal.nodal=this),Nodal.nodal}return _createClass(Nodal,[{key:"show",value:function(html){this.container.innerHTML=html,this.container.classList.remove("amst__hidden"),document.body.classList.add("amst__overflow-hidden"),_classPrivateFieldSet(this,_visible,!0)}},{key:"hide",value:function(){this.container.innerHTML="",this.container.classList.add("amst__hidden"),document.body.classList.remove("amst__overflow-hidden"),_classPrivateFieldSet(this,_visible,!1)}},{key:"visible",get:function(){return _classPrivateFieldGet(this,_visible)}}]),Nodal}());Object.freeze(nodal);var w=window,s=w.sessionStorage,UA=w.navigator.userAgent.toLowerCase(),isIos=/ipad|iphone|ipod/i.test(UA)&&!w.MSStream,isMobile=isIos||/android/i.test(UA),isIE=UA.indexOf("MSIE ")>0||!!navigator.userAgent.match(/Trident.*rv\:11\./),_init=new WeakMap,_paused=new WeakMap,AmstramgramAudioPlayer=function(_EventEmitter){_inherits(AmstramgramAudioPlayer,_EventEmitter);var _super=_createSuper(AmstramgramAudioPlayer);function AmstramgramAudioPlayer(media){var _this,params=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},callback=arguments.length>2?arguments[2]:void 0,WrappingClass=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;if(_classCallCheck(this,AmstramgramAudioPlayer),"function"==typeof params&&(callback=params,params={}),_this=_super.call(this),_init.set(_assertThisInitialized(_this),{writable:!0,value:!1}),_paused.set(_assertThisInitialized(_this),{writable:!0,value:!0}),!media||"AUDIO"!=media.tagName&&"VIDEO"!=media.tagName)return _possibleConstructorReturn(_this);if(!WrappingClass&&"AUDIO"!=media.tagName)return _possibleConstructorReturn(_this);if(WrappingClass&&"AmstramgramMediaPlayer"!=WrappingClass.name)return _possibleConstructorReturn(_this);if(WrappingClass&&(!callback||"function"!=typeof callback))return _possibleConstructorReturn(_this);var Class=_this.constructor,myParams=clone(Class.options),$=_$(document.createElement("div"));_$$($());var classes="amst__wrapper";window.document.documentMode&&(classes+=" amst__ie"),$().setAttributes({class:classes,"aria-label":"".concat(myParams.appLabel),role:"application"}).insertAdjacentHTML("beforeend",'\n        <span class="amst__offscreen">'.concat(myParams.appLabel,'</span>\n        <div class="amst__container" tabindex="0">\n          <div class="amst__mediaelement"></div>\n        </div>\n      ')),media.parentNode.insertBefore($(),media),$(".amst__mediaelement").appendChild(media),myParams.$=$,myParams.$$=_$$($()),myParams.media=$(media),myParams.isIos=isIos,myParams.isMobile=isMobile,myParams.isIE=isIE,myParams.type=Class==AmstramgramAudioPlayer?"audio":"video",media.controls=!1,params=buildSrcParams(params,media,!1),media.muted&&(!isNaN(params.volume)&&params.volume>0&&params.volume<=1?media.muted=!1:params.volume=0,media.removeAttribute("muted")),Class.booleanAttributes.forEach((function(a){params[a]="boolean"==typeof params[a]?params[a]:1==media[a]||void 0,Class.attributesToUpdate.includes(a)||media.removeAttribute(a)})),Class.stringAttributes.forEach((function(a){params[a]="string"==typeof params[a]?params[a]:media.getAttribute(a),Class.attributesToUpdate.includes(a)||media.removeAttribute(a)})),mergeDeep(myParams,params),Object.assign(myParams,pointerDetector.data),myParams.currentPointerType=pointerDetector.currentPointerType,myParams.nodal=nodal;var ordered={};Object.keys(myParams).sort().forEach((function(key){ordered[key]=myParams[key]})),_this.params=ordered;var self=_assertThisInitialized(_this);if("pointer"==pointerDetector.data.pointerEventsInterface){function onPointerChange(){self.params.currentPointerType=pointerDetector.currentPointerType,"mouse"==pointerDetector.currentPointerType?$().classList.add("amst__mouse"):$().classList.remove("amst__mouse")}pointerDetector.on("amst__pointerChange",onPointerChange),onPointerChange()}else"mouse"==pointerDetector.pointerEventsInterface&&$().classList.add("amst__mouse");return _classStaticPrivateFieldSpecGet(AmstramgramAudioPlayer,AmstramgramAudioPlayer,_players).push(_assertThisInitialized(_this)),_this._buildUI(),_this.src=_this.params,_this.constructor.buttons.forEach((function(k){Object.defineProperty(_assertThisInitialized(_this),k,{set:function(opt){var o={};o[k]=opt,mergeDeep(_this.params,o),_this.emit("amst__".concat(k,"-should-update"))}})})),_classPrivateFieldSet(_assertThisInitialized(_this),_init,!0),callback&&"function"==typeof callback&&setTimeout((function(_){callback.call(_assertThisInitialized(_this)),1==_this.params.autoplay&&setTimeout((function(_){return self.play()}),1)}),1),_this}return _createClass(AmstramgramAudioPlayer,[{key:"_buildUI",value:function(){this.constructor!=AmstramgramAudioPlayer||this.init||(new AudioUI(this),this.params.$().classList.add("amst__audio"))}},{key:"init",get:function(){return _classPrivateFieldGet(this,_init)}},{key:"currentTime",get:function(){return this.params.media.currentTime},set:function(t){try{this.params.media.currentTime=t}catch(e){console.warn(e)}}},{key:"muted",get:function(){return this.params.media.muted},set:function(bool){"boolean"==typeof bool&&(this.params.media.muted=bool)}},{key:"paused",get:function(){return _classPrivateFieldGet(this,_paused)}},{key:"playbackRate",get:function(){return this.params.media.playbackRate},set:function(rate){this.params.media.playbackRate=rate}},{key:"src",get:function(){return this.params.media.src},set:function(src){this.pause();var params=this.params,media=params.media,type=params.type;try{this.params.media.currentTime=0}catch(e){}if(this.init){src=buildSrcParams(src,media);var mySrc=this.constructor.srcOptions;mergeDeep(mySrc,src),mergeDeep(params,mySrc)}if(0!=params.src.length){var rightSrc=params.src.find((function(el){return el.quality&&el.quality==s.getItem("amst__".concat(type,"DefaultQuality"))}))||params.src.find((function(el){return 1==el.default}))||params.src[0];rightSrc.quality&&rightSrc.quality!=s.getItem("amst__".concat(type,"DefaultQuality"))&&s.setItem("amst__".concat(type,"DefaultQuality"),rightSrc.quality),rightSrc.type?media.setAttribute("type",rightSrc.type):media.removeAttribute("type"),media.src=rightSrc.src,media.playbackRate=params.playbackRate,this.constructor.attributesToUpdate.forEach((function(a){media[a]=params[a]})),this.emit("amst__src-change"),this.init&&1==params.autoplay&&this.play()}else params.$().classList.add("amst__show-error")}},{key:"volume",get:function(){return this.params.media.muted?0:this.params.media.volume},set:function(vol){var _this2=this;if(!(isNaN(vol)||vol<0||vol>1||vol==this.volume||this.params.isMobile&&0!=vol&&1!=vol)){var params=this.params,media=params.media;vol>0&&(media.volume=vol,media.muted&&(media.muted=!1)),0!=vol||media.muted||(media.muted=!0),AmstramgramAudioPlayer.players.filter((function(p){return p!=_this2&&p.params.volumeGroup==params.volumeGroup&&p.volume!=vol})).forEach((function(p){return p.volume=vol}))}}},{key:"hideControls",value:function(){}},{key:"pause",value:function(){this.paused||(_classPrivateFieldSet(this,_paused,!0),this.params.media.paused||this.params.media.pause(),this.emit("amst__pause"))}},{key:"play",value:function(){if(this.paused&&this.src){var self=this;if(this.params.media.paused){AmstramgramAudioPlayer.currentPlayer&&this!=AmstramgramAudioPlayer.currentPlayer&&(AmstramgramAudioPlayer.currentPlayer.pause(),AmstramgramAudioPlayer.currentPlayer.emit("amst__should-reset")),_classPrivateFieldSet(this,_paused,!1),this.emit("amst__should-play");var media=this.params.media;function playIt(){var playPromise=media.play();void 0!==playPromise?playPromise.then(playSucceed).catch((function(e){self.emit("amst__pause")})):playSucceed()}0!=media.readyState||isIE?playIt():(media.on("loadeddata",(function onDataLoaded(){media.off("loadeddata",onDataLoaded),playIt()})),media.load())}function playSucceed(){var receiver,descriptor,value;self.emit("amst__play"),descriptor=_currentPlayer,value=self,_classCheckPrivateStaticAccess(receiver=AmstramgramAudioPlayer,AmstramgramAudioPlayer),_classCheckPrivateStaticFieldDescriptor(descriptor,"set"),_classApplyDescriptorSet(receiver,descriptor,value)}}}},{key:"showControls",value:function(){}},{key:"toggle",value:function(){this.paused?this.play():this.pause()}}],[{key:"booleanAttributes",get:function(){return["autoplay","loop"]}},{key:"stringAttributes",get:function(){return["crossOrigin","preload","type"]}},{key:"attributesToUpdate",get:function(){return["crossOrigin","loop","preload","type"]}},{key:"buttons",get:function(){var _this3=this;return Object.keys(this.srcOptions).filter((function(k){return isObject(_this3.srcOptions[k])&&(_this3.srcOptions[k].hasOwnProperty("label")||_this3.srcOptions[k].hasOwnProperty("hidden"))}))}},{key:"instanceOptions",get:function(){return clone(_classStaticPrivateFieldSpecGet(this,AmstramgramAudioPlayer,_instanceOptions))}},{key:"srcOptions",get:function(){return clone(_classStaticPrivateFieldSpecGet(this,AmstramgramAudioPlayer,_srcOptions))}},{key:"options",get:function(){return _objectSpread2(_objectSpread2({},this.instanceOptions),this.srcOptions)},set:function(opt){new Array(_classStaticPrivateFieldSpecGet(this,AmstramgramAudioPlayer,_instanceOptions),_classStaticPrivateFieldSpecGet(this,AmstramgramAudioPlayer,_srcOptions)).forEach((function(obj){mergeDeep(obj,opt)}))}},{key:"players",get:function(){return _toConsumableArray(_classStaticPrivateFieldSpecGet(this,AmstramgramAudioPlayer,_players))}},{key:"currentPlayer",get:function(){return _classStaticPrivateFieldSpecGet(this,AmstramgramAudioPlayer,_currentPlayer)}}]),AmstramgramAudioPlayer}(EventEmitter),_instanceOptions={writable:!0,value:AudioDefaultOptions.instance},_srcOptions={writable:!0,value:AudioDefaultOptions.src},_players={writable:!0,value:[]},_currentPlayer={writable:!0,value:void 0};return AmstramgramAudioPlayer}();
